{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ref } from 'vue';\nexport default {\n  name: 'PurchaseComplete',\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n    let nickName = ref('');\n    let login = ref(true);\n    let paymentKey = new URLSearchParams(window.location.search).get('paymentKey');\n    let orderId = ref(route.query.orderId);\n    let amount = new URLSearchParams(window.location.search).get('amount');\n    let payMethod = ref(route.query.payMethod);\n    let price = ref(route.query.price);\n    let info = new URLSearchParams(window.location.search).get('info');\n    let purchaseInfo = JSON.parse(info);\n    let encodedSecret = btoa(process.env.VUE_APP_SECRET_KEY + ':');\n    const headers = {\n      'Authorization': 'Basic ' + encodedSecret,\n      'Content-Type': 'application/json'\n    };\n\n    // 결제승인 API 호출\n    const data = {\n      paymentKey: paymentKey,\n      amount: amount,\n      orderId: orderId.value\n    };\n    axios.get('/api/product/submit').then(result => {\n      if (result.data === 'need login') {\n        login.value = false;\n        if (route.query.cashOrderId) {\n          orderId.value = route.query.cashOrderId;\n        }\n      } else nickName.value = result.data;\n    }).catch(error => {\n      console.error(error);\n    });\n    if (paymentKey) {\n      axios.post('https://api.tosspayments.com/v1/payments/confirm', data, {\n        headers\n      }).then(response => {\n        return axios.post('/api/product/submitReport', response.data);\n      }).then(() => {\n        if (Array.isArray(purchaseInfo)) {\n          for (let i = 0; i < purchaseInfo.length; i++) {\n            purchaseInfo[i].realPay = amount;\n            purchaseInfo[i].orderId = parseInt(orderId.value);\n          }\n          return axios.post('/api/product/cartPurchase', purchaseInfo);\n        } else {\n          purchaseInfo.realPay = amount;\n          purchaseInfo.orderId = parseInt(orderId.value);\n          return axios.post('/api/product/purchase', purchaseInfo);\n        }\n      }).catch(error => {\n        console.error(error);\n      });\n    }\n    function clickHome() {\n      router.push({\n        path: '/'\n      });\n    }\n    function clickPurchaseList() {\n      router.push({\n        name: 'MyPage',\n        query: {\n          nickName: nickName.value,\n          cart: 0\n        }\n      });\n    }\n    function filter(val) {\n      return String(val).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n    }\n    return {\n      clickHome,\n      clickPurchaseList,\n      orderId,\n      login,\n      payMethod,\n      price,\n      filter\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","useRoute","useRouter","ref","name","setup","router","route","nickName","login","paymentKey","URLSearchParams","window","location","search","get","orderId","query","amount","payMethod","price","info","purchaseInfo","JSON","parse","encodedSecret","btoa","process","env","VUE_APP_SECRET_KEY","headers","data","value","then","result","cashOrderId","catch","error","console","post","response","Array","isArray","i","length","realPay","parseInt","clickHome","push","path","clickPurchaseList","cart","filter","val","String","replace"],"sourceRoot":"","sources":["/Users/dino/Desktop/project/golfMarket/TGolShop/src/components/PurchaseComplete.vue"],"sourcesContent":["<template>\n  \n  <div class=\"container d-flex justify-content-center\">\n    <div style=\"width:80%;\" class=\"border mt-5\">\n      <div class=\"ms-1 me-1\">\n        <div style=\"font-size:large;\" class=\"d-none d-sm-block mt-5 mb-3\">\n          구매를 성공적으로 완료하였습니다.\n        </div>\n        <div style=\"font-size:medium;\" class=\"d-block d-sm-none mt-5 mb-3\">\n          구매를 성공적으로 완료하였습니다.\n        </div>\n        <div class=\"mb-3\" v-if=\"login === false\">\n          <div style=\"font-size: small;\">주문 번호: {{orderId}}</div> <div style=\"color:red; font-size: small;\">(비회원께서는 주문 조회를 위해 반드시 숙지하셔야 합니다.)</div>\n        </div>\n        <div class=\"mb-3\" v-if=\"payMethod === '무통장입금'\">\n          <div style=\"font-size: small;\">무통장 입금 계좌: 대구은행 508-10-844784-5 티골프 피팅(김수환)</div>\n          <div style=\"font-size: small;\">입금 금액: {{ filter(parseInt(price)) }}원</div>\n          <div style=\"color:red; font-size: small;\">입금자 명과 주문정보가 일치해야 합니다.</div>\n          <div style=\"color:red; font-size: small;\">주문 날짜로부터 3일 내에 입금 처리가 되지 않으면 자동으로 주문 취소 처리됩니다.</div>\n        </div>\n        <button @click=\"clickHome\" style=\"font-weight: bold; font-size: large;\" class=\"btn btn-danger me-1 mb-5 mt-2\">홈으로</button>\n        <button v-if=\"login\" @click=\"clickPurchaseList\" style=\"font-weight: bold; font-size: large;\" class=\"btn btn-success ms-1 mb-5 mt-2\">주문목록</button>\n      </div>\n      \n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport { useRoute, useRouter } from 'vue-router'\nimport { ref } from 'vue';\nexport default {\n  name:'PurchaseComplete',\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n    let nickName = ref('');\n    let login = ref(true);\n    let paymentKey = new URLSearchParams(window.location.search).get('paymentKey');\n    let orderId = ref(route.query.orderId);\n    let amount = new URLSearchParams(window.location.search).get('amount');\n    let payMethod = ref(route.query.payMethod);\n    let price = ref(route.query.price);\n    \n    let info = new URLSearchParams(window.location.search).get('info');\n    let purchaseInfo = JSON.parse(info);\n    let encodedSecret = btoa(process.env.VUE_APP_SECRET_KEY + ':');\n    const headers = {\n      'Authorization': 'Basic ' + encodedSecret,\n      'Content-Type': 'application/json'\n    };\n\n    // 결제승인 API 호출\n    const data = {\n      paymentKey: paymentKey,\n      amount: amount,\n      orderId: orderId.value\n    };\n\n    axios.get('/api/product/submit')\n    .then(result=>{\n      if(result.data === 'need login') {\n        login.value = false;\n        if(route.query.cashOrderId) {\n          orderId.value = route.query.cashOrderId;\n        }\n      } else nickName.value = result.data;\n    })\n    .catch(error => {\n      console.error(error);\n    });\n\n    if (paymentKey) {\n      axios.post('https://api.tosspayments.com/v1/payments/confirm', data, { headers })\n      .then(response => {\n        return axios.post('/api/product/submitReport', response.data);\n      })\n      .then(()=>{\n\n        if(Array.isArray(purchaseInfo)) {\n          for(let i = 0; i < purchaseInfo.length; i++) {\n            purchaseInfo[i].realPay = amount;\n            purchaseInfo[i].orderId = parseInt(orderId.value);\n           }\n          return axios.post('/api/product/cartPurchase', purchaseInfo)\n        } else {\n          purchaseInfo.realPay = amount;\n          purchaseInfo.orderId = parseInt(orderId.value);\n          return axios.post('/api/product/purchase', purchaseInfo);\n        }\n      })\n      .catch(error => {\n        console.error(error);\n      });\n    }\n    \n    \n   \n    \n\n    function clickHome() {\n      router.push({path : '/'});\n    }\n    function clickPurchaseList() {\n      router.push({name : 'MyPage', query : {nickName : nickName.value, cart : 0}});\n    }\n\n    function filter(val) {\n      return String(val).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n    }\n\n    return {clickHome, clickPurchaseList, orderId, login, payMethod, price, filter};\n  }\n}\n</script>\n\n<style>\n\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}